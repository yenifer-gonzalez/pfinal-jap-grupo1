<!DOCTYPE html>
<html lang="es">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes"
    />
    <title>Mi Perfil - e-Mercado | Gestiona tu cuenta</title>
    <meta
      name="description"
      content="Administra tu información personal, historial de compras y preferencias. Tu espacio personal en e-Mercado."
    />
    <meta name="author" content="Grupo 1 - JAP 2024" />

    <!-- Fuentes -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Raleway:ital,wght@0,100..900;1,100..900&display=swap"
      rel="stylesheet"
    />
    <!-- Icons de Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css"
    />
    <link href="css/font-awesome.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap.min.css" />
    <link rel="stylesheet" href="css/variables.css" />
    <link rel="stylesheet" href="css/styles.css" />
    <link rel="stylesheet" href="css/my-profile.css" />

    <!-- Preload de recursos -->
    <link rel="preconnect" href="https://japceibal.github.io" />
    <link rel="dns-prefetch" href="https://japceibal.github.io" />
  </head>

  <body>
    <!-- ======= Header ======= -->
    <header class="main-header">
      <div class="header-container">
        <div class="header-logo">
          <a href="index.html" class="logo-icon">
            <img
              src="img/logo-jap.svg"
              alt="e-Mercado - Tienda online de productos"
              class="logo-img"
            />
          </a>
        </div>

        <nav class="main-nav">
          <a href="index.html" class="nav-link">Inicio</a>
          <a href="categories.html" class="nav-link">Categorías</a>
          <a href="products.html" class="nav-link">Productos</a>
          <a href="sell.html" class="nav-link">Vender</a>
        </nav>

        <!-- Usuario / Login -->
        <div class="user-section">
          <div id="userSection" class="dropdown">
            <button
              class="btn user-avatar dropdown-toggle"
              type="button"
              id="userDropdown"
              data-bs-toggle="dropdown"
              aria-expanded="false"
            >
              <i class="bi bi-person me-2"></i>
              <span id="usernameDisplay"></span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
              <li>
                <a class="dropdown-item active" aria-current="page" href="my-profile.html"
                  ><i class="bi bi-person-circle me-2"></i>Mi perfil</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="my-profile.html#pedidos"
                  onclick="event.preventDefault(); document.getElementById('tab-orders').click();"
                  ><i class="bi bi-box-seam me-2"></i>Mis pedidos</a
                >
              </li>
              <li>
                <a
                  class="dropdown-item"
                  href="my-profile.html#favoritos"
                  onclick="event.preventDefault(); document.getElementById('tab-favorites').click();"
                  ><i class="bi bi-heart me-2"></i>Mis favoritos</a
                >
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item" id="logoutBtn" data-logout href="#"
                  ><i class="bi bi-box-arrow-right me-2"></i>Cerrar sesión</a
                >
              </li>
            </ul>
          </div>
          <a href="cart.html" class="cart-icon" aria-label="Ir al carrito">
            <i class="bi bi-cart3"></i>
            <span
              id="cartBadge"
              class="cart-badge"
              aria-live="polite"
              aria-label="Productos en carrito"
              >0</span
            >
          </a>
        </div>
        <div class="mobile-actions">
          <a href="cart.html" class="cart-icon-mobile" aria-label="Ir al carrito">
            <i class="bi bi-cart3"></i>
            <span
              id="cartBadgeMobile"
              class="cart-badge"
              aria-live="polite"
              aria-label="Productos en carrito"
              >0</span
            >
          </a>
          <button id="menuButton" class="btn menu-toggle" aria-label="Abrir menú">
            <i class="bi bi-list"></i>
          </button>
        </div>
      </div>
    </header>

    <!-- Sidebar Navegación -->
    <aside id="navSidebar" class="sidebar right hidden">
      <div class="sidebar-content">
        <div class="user-info">
          <i class="bi bi-person-circle"></i>
          <p id="sidebarUsername">example@gmail.com</p>
        </div>
        <nav class="sidebar-nav">
          <a href="index.html">Inicio</a>
          <a href="categories.html">Categorías</a>
          <a href="products.html">Productos</a>
          <a href="sell.html">Vender</a>
          <a href="my-profile.html">Mi perfil</a>
          <a href="cart.html">Mi carrito</a>
        </nav>
        <hr />
        <button
          class="sidebar-theme-toggle"
          id="theme-toggle-sidebar"
          aria-label="Toggle dark/light theme"
        >
          <span>Modo oscuro</span>
          <i class="fas fa-moon" aria-hidden="true"></i>
        </button>
        <a href="#" class="sidebar-logout" data-logout>
          <i class="bi bi-box-arrow-right me-2"></i> Cerrar sesión
        </a>
      </div>
    </aside>

    <!-- Overlay para el sidebar -->
    <div id="overlay" class="overlay hidden"></div>

    <!-- ======= Main ======= -->
    <main class="profile-container" aria-labelledby="profile-title">
      <section class="profile-layout">
        <!-- Columna izquierda: avatar + nombre + tabs -->
        <aside class="profile-sidebar" aria-label="Panel de usuario">
          <div class="profile-card">
            <div class="profile-avatar">
              <img
                id="profileAvatar"
                src="img/img_perfil.png"
                alt="Foto de perfil"
                loading="lazy"
              />
            </div>
            <p id="profileSidebarName">Nombre Apellido</p>

            <nav class="profile-nav" aria-label="Secciones del perfil">
              <button
                id="tab-data"
                class="profile-tab-btn active"
                type="button"
                data-target="panel-data"
              >
                <i class="bi bi-person-lines-fill me-2"></i> Mis datos
              </button>
              <button
                id="tab-orders"
                class="profile-tab-btn"
                type="button"
                data-target="panel-orders"
              >
                <i class="bi bi-box-seam me-2"></i> Mis pedidos
              </button>
              <button
                id="tab-favorites"
                class="profile-tab-btn"
                type="button"
                data-target="panel-favorites"
              >
                <i class="bi bi-heart me-2"></i> Lista de deseos
              </button>
              <button
                id="tab-addresses"
                class="profile-tab-btn"
                type="button"
                data-target="panel-addresses"
              >
                <i class="bi bi-geo-alt me-2"></i> Mis direcciones
              </button>
              <button
                id="tab-cards"
                class="profile-tab-btn"
                type="button"
                data-target="panel-cards"
              >
                <i class="bi bi-credit-card me-2"></i> Métodos de pago
              </button>
            </nav>
          </div>
        </aside>

        <!-- Columna derecha: contenido -->
        <section class="profile-content">
          <!-- Panel: Mis datos (default) -->
          <article id="panel-data" class="profile-panel" aria-labelledby="panel-data-title">
            <header class="profile-panel-header">
              <h2 id="panel-data-title">Datos del usuario</h2>
            </header>

            <!-- Foto + acciones -->
            <div class="profile-photo-row">
              <div class="profile-photo-box">
                <img
                  id="profilePhotoPreview"
                  src="img/img_perfil.png"
                  alt="Foto actual del usuario"
                  loading="lazy"
                />
              </div>

              <div class="photo-actions vertical">
                <input id="profilePhotoInput" type="file" accept="image/*" hidden />
                <button id="btnPhotoEdit" class="btn-photo btn-sm" type="button">
                  <i class="bi bi-pencil-fill"></i>
                  <span class="btn-text">Editar</span>
                </button>
                <button id="btnPhotoRemove" class="btn-photo btn-sm" type="button">
                  <i class="bi bi-trash-fill"></i>
                  <span class="btn-text">Eliminar</span>
                </button>
              </div>
            </div>

            <!-- Formulario de datos -->
            <form id="profileForm" action="#" method="post" novalidate>
              <div class="form-row">
                <label for="firstName">Nombre</label>
                <input id="firstName" name="firstName" type="text" autocomplete="given-name" />
              </div>

              <div class="form-row">
                <label for="lastName">Apellido</label>
                <input id="lastName" name="lastName" type="text" autocomplete="family-name" />
              </div>

              <div class="form-row">
                <label for="email">Mail</label>
                <input
                  id="email"
                  name="email"
                  type="email"
                  required
                  autocomplete="email"
                  placeholder="example@gmail.com"
                />
              </div>

              <div class="form-row">
                <label for="phone">Número de celular</label>
                <input
                  id="phone"
                  name="phone"
                  type="tel"
                  autocomplete="tel"
                  placeholder="+598 99123456"
                />
              </div>

              <div class="form-actions">
                <button id="btnSaveProfile" type="submit">Guardar cambios</button>
                <button id="btnResetProfile" type="reset">Restablecer</button>
              </div>
            </form>
          </article>

          <!-- ========= Panel: Mis Direcciones ========= -->
          <article
            id="panel-addresses"
            class="profile-panel"
            aria-labelledby="panel-addresses-title"
            hidden
          >
            <header class="addresses-header">
              <h2 id="panel-addresses-title">Mis direcciones de envío</h2>
              <button id="btnAddAddress" class="btn-add-address" type="button">
                <i class="bi bi-plus-circle me-2"></i>
                Agregar dirección
              </button>
            </header>

            <!-- Lista de direcciones -->
            <div id="addressesList" class="addresses-list">
              <div class="no-addresses">
                <i class="bi bi-geo-alt"></i>
                <p>No tienes direcciones guardadas</p>
                <p class="text-muted">
                  Agrega tu primera dirección para hacer tus compras más rápido
                </p>
              </div>
            </div>
          </article>

          <!-- ========= Panel: Mis Tarjetas ========= -->
          <article
            id="panel-cards"
            class="profile-panel"
            aria-labelledby="panel-cards-title"
            hidden
          >
            <header class="addresses-header">
              <h2 id="panel-cards-title">Mis tarjetas de pago</h2>
              <button id="btnAddCard" class="btn-add-address" type="button">
                <i class="bi bi-plus-circle me-2"></i>
                Agregar tarjeta
              </button>
            </header>

            <!-- Lista de tarjetas -->
            <div id="cardsList" class="cards-list">
              <!-- Las tarjetas se cargarán dinámicamente aquí -->
              <div class="no-addresses">
                <i class="bi bi-credit-card"></i>
                <h3>No tienes tarjetas guardadas</h3>
                <p>Agrega una tarjeta para facilitar tus compras futuras</p>
              </div>
            </div>
          </article>

          <!-- ========= Panel: Mis Pedidos ========= -->
          <article
            id="panel-orders"
            class="profile-panel"
            aria-labelledby="panel-orders-title"
            hidden
          >
            <header class="profile-panel-header">
              <h2 id="panel-orders-title">Mis pedidos</h2>
            </header>

            <div class="orders-content">
              <!-- Nota de simulación -->
              <div class="simulation-notice">
                <i class="bi bi-info-circle"></i>
                <span
                  ><strong>Simulación:</strong> En un entorno real, los pedidos cambiarían de estado
                  automáticamente (pendiente → confirmado → completado). Por ahora, todos los
                  pedidos se crean como "Pendientes".</span
                >
              </div>

              <!-- Filtros de pedidos -->
              <div class="orders-filters">
                <button class="filter-btn active" data-filter="all">
                  <i class="bi bi-list-ul"></i> Todos
                </button>
                <button class="filter-btn" data-filter="pending">
                  <i class="bi bi-clock-history"></i> Pendientes
                </button>
                <button class="filter-btn" data-filter="confirmed">
                  <i class="bi bi-check-circle"></i> Confirmados
                </button>
                <button class="filter-btn" data-filter="completed">
                  <i class="bi bi-check-all"></i> Completados
                </button>
              </div>

              <!-- Lista de pedidos -->
              <div id="ordersList" class="orders-list"></div>
            </div>
          </article>

          <!-- ========= Panel: Mis Favoritos ========= -->
          <article
            id="panel-favorites"
            class="profile-panel"
            aria-labelledby="panel-favorites-title"
            hidden
          >
            <header class="profile-panel-header">
              <h2 id="panel-favorites-title">Mis productos favoritos</h2>
            </header>

            <div class="favorites-content">
              <!-- Lista de favoritos -->
              <div id="favoritesList" class="favorites-grid"></div>
            </div>
          </article>
        </section>
      </section>

      <!-- Overlay del modal -->
      <div id="modalOverlay" class="modal-overlay"></div>

      <!-- Modal para agregar/editar dirección -->
      <aside
        id="addressModal"
        class="address-modal"
        role="dialog"
        aria-modal="true"
        aria-labelledby="addressModalTitle"
      >
        <div class="address-modal-dialog">
          <header class="address-modal-header">
            <h3 id="addressModalTitle">Agregar dirección</h3>
            <button
              id="closeAddressModalBtn"
              type="button"
              class="btn-close-modal"
              aria-label="Cerrar"
            >
              <i class="bi bi-x-lg"></i>
            </button>
          </header>

          <form id="addressForm" class="address-form">
            <input type="hidden" id="addressId" />

            <!-- Alias -->
            <div class="form-group">
              <label for="addressAlias">Alias de la dirección *</label>
              <input
                type="text"
                id="addressAlias"
                name="alias"
                placeholder="Ej: Casa, Oficina, Trabajo"
                required
                autocomplete="off"
              />
            </div>

            <!-- Calle -->
            <div class="form-group">
              <label for="addressStreet">Calle y número *</label>
              <input
                type="text"
                id="addressStreet"
                name="street"
                placeholder="Ej: Av. 18 de Julio 1234"
                required
                autocomplete="address-line1"
              />
            </div>

            <!-- Esquina -->
            <div class="form-group">
              <label for="addressCorner">Esquina (opcional)</label>
              <input
                type="text"
                id="addressCorner"
                name="corner"
                placeholder="Ej: Esquina Ejido"
                autocomplete="address-line2"
              />
            </div>

            <!-- Apartamento -->
            <div class="form-group">
              <label for="addressApartment">Apartamento/Unidad (opcional)</label>
              <input
                type="text"
                id="addressApartment"
                name="apartment"
                placeholder="Ej: Apto 4B, Casa 5"
                autocomplete="address-line2"
              />
            </div>

            <!-- Ciudad y Departamento -->
            <div class="form-row-group">
              <div class="form-group">
                <label for="addressCity">Ciudad *</label>
                <input
                  type="text"
                  id="addressCity"
                  name="city"
                  placeholder="Montevideo"
                  required
                  autocomplete="address-level2"
                />
              </div>

              <div class="form-group">
                <label for="addressState">Departamento *</label>
                <input
                  type="text"
                  id="addressState"
                  name="state"
                  placeholder="Montevideo"
                  required
                  autocomplete="address-level1"
                />
              </div>
            </div>

            <!-- Código postal y País -->
            <div class="form-row-group">
              <div class="form-group">
                <label for="addressZipCode">Código postal *</label>
                <input
                  type="text"
                  id="addressZipCode"
                  name="zipCode"
                  placeholder="11200"
                  required
                  autocomplete="postal-code"
                />
              </div>

              <div class="form-group">
                <label for="addressCountry">País *</label>
                <input
                  type="text"
                  id="addressCountry"
                  name="country"
                  value="Uruguay"
                  required
                  autocomplete="country"
                />
              </div>
            </div>

            <!-- Teléfono -->
            <div class="form-group">
              <label for="addressPhone">Teléfono de contacto *</label>
              <input
                type="tel"
                id="addressPhone"
                name="phone"
                placeholder="+598 99 123 456"
                required
                autocomplete="tel"
              />
            </div>

            <!-- Instrucciones -->
            <div class="form-group">
              <label for="addressInstructions">Instrucciones de entrega (opcional)</label>
              <textarea
                id="addressInstructions"
                name="instructions"
                rows="3"
                placeholder="Ej: Portón azul, timbre 4B, dejar con el portero"
              ></textarea>
            </div>

            <!-- Dirección predeterminada -->
            <div class="form-group">
              <div class="form-check">
                <input
                  type="checkbox"
                  id="addressIsDefault"
                  name="isDefault"
                  class="form-check-input"
                />
                <label for="addressIsDefault" class="form-check-label">
                  Usar como dirección predeterminada
                </label>
              </div>
            </div>
          </form>

          <!-- Botones de acción -->
          <div class="address-modal-footer">
            <button id="cancelAddressModal" type="button" class="btn-cancel-modal">Cancelar</button>
            <button type="submit" form="addressForm" class="btn-save-address">
              <i class="bi bi-check-circle me-2"></i>
              Guardar dirección
            </button>
          </div>
        </div>
      </aside>
    </main>

    <!-- ========= Modal: Agregar/Editar Tarjeta ========= -->
    <aside
      id="cardModal"
      class="address-modal"
      role="dialog"
      aria-modal="true"
      aria-labelledby="cardModalTitle"
    >
      <div class="address-modal-dialog">
        <header class="address-modal-header">
          <h3 id="cardModalTitle">Agregar tarjeta de pago</h3>
          <button id="closeCardModal" class="btn-close-modal" type="button" aria-label="Cerrar">
            <i class="bi bi-x-lg"></i>
          </button>
        </header>

        <form id="cardForm" class="address-form">
          <input type="hidden" id="cardId" />

          <!-- Número de tarjeta -->
          <div class="form-group">
            <label for="cardNumber"> Número de tarjeta <span class="text-danger">*</span> </label>
            <input
              type="text"
              id="cardNumber"
              name="cardNumber"
              class="form-control"
              placeholder="1234 5678 9012 3456"
              maxlength="19"
              required
              autocomplete="cc-number"
            />
            <small class="form-text">Solo se guardarán los últimos 4 dígitos</small>
          </div>

          <!-- Nombre en la tarjeta -->
          <div class="form-group">
            <label for="cardName"> Nombre en la tarjeta <span class="text-danger">*</span> </label>
            <input
              type="text"
              id="cardName"
              name="cardName"
              class="form-control"
              placeholder="Juan Pérez"
              required
              autocomplete="cc-name"
            />
          </div>

          <!-- Fecha de vencimiento y CVV -->
          <div class="form-row-group">
            <div class="form-group">
              <label for="cardExpiry"> Vencimiento <span class="text-danger">*</span> </label>
              <input
                type="text"
                id="cardExpiry"
                name="cardExpiry"
                class="form-control"
                placeholder="MM/AA"
                maxlength="5"
                required
                autocomplete="cc-exp"
              />
              <small class="form-text">Formato: MM/AA</small>
            </div>

            <div class="form-group">
              <label for="cardCvv"> CVV <span class="text-danger">*</span> </label>
              <input
                type="text"
                id="cardCvv"
                name="cardCvv"
                class="form-control"
                placeholder="123"
                maxlength="4"
                required
                autocomplete="cc-csc"
              />
              <small class="form-text">No se guardará por seguridad</small>
            </div>
          </div>

          <!-- Alias de la tarjeta -->
          <div class="form-group">
            <label for="cardAlias"> Alias (opcional) </label>
            <input
              type="text"
              id="cardAlias"
              name="cardAlias"
              class="form-control"
              placeholder="Mi tarjeta principal"
              maxlength="50"
            />
            <small class="form-text">Dale un nombre para identificarla fácilmente</small>
          </div>

          <!-- Tarjeta predeterminada -->
          <div class="form-group">
            <div class="form-check">
              <input
                type="checkbox"
                id="cardIsDefault"
                name="cardIsDefault"
                class="form-check-input"
              />
              <label for="cardIsDefault" class="form-check-label">
                Usar como tarjeta predeterminada
              </label>
            </div>
          </div>
        </form>

        <!-- Botones de acción -->
        <div class="address-modal-footer">
          <button id="cancelCardModal" type="button" class="btn-cancel-modal">Cancelar</button>
          <button type="submit" form="cardForm" class="btn-save-address">
            <i class="bi bi-check-circle me-2"></i>
            Guardar tarjeta
          </button>
        </div>
      </div>
    </aside>

    <!-- ======= Footer ======= -->
    <footer>
      <div class="footer-container">
        <p class="footer-text">
          Este sitio forma parte de
          <a href="https://jovenesaprogramar.edu.uy/" target="_blank">Jóvenes a Programar</a>
        </p>
        <p class="footer-back-to-top">
          <a href="#">Volver arriba</a>
        </p>
      </div>
    </footer>

    <button id="theme-toggle" class="theme-toggle-btn" aria-label="Toggle dark/light theme">
      <i class="fas fa-moon" aria-hidden="true"></i>
    </button>

    <script src="js/bootstrap.bundle.min.js" defer></script>
    <script src="js/init.js" defer></script>
    <script src="js/my-profile.js" defer></script>
  </body>
</html>
